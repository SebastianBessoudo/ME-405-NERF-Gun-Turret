<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME-405 Term Project NERF gun Turret
   </div>
   <div id="projectbrief">Authors: Sebastian Bessoudo and Nathaniel Davis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Main Page</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="sec_intro1"></a>
Software Design</h1>
<p >Our `main.py` consists of three tasks: `task1_mm()`, `task2_motorcontrol()`, and `task3_camera()`. These tasks share essential variables like `ir_angle` (from `task3_camera()`) for target alignment and `motor_setpoint` (from `task2_motorcontrol()`) for motor rotation.

`task1_mm()` acts as the Mastermind, guiding the overall flow of the program. Initially, at state 0, it initializes key inputs from the Nucleo, including the servo motor, flywheel, and button. It then switches to state 1, where it waits for the button to be triggered. Once the button is activated, it moves to state 2, having the motor rotate 180 degrees, with `motor_setpoint` set to 1600. Here, `task2_motorcontrol()` takes charge, utilizing the motor_driver, the encoder, and motor_control to set up and execute the rotation and ensure alignment with the designated spot.

A 6-second delay in Mastermind is introduced to allow the motor to reach its setpoint. During this time, `task3_camera()` captures infrared images every second, providing real-time updates on the target's position. These images are processed into CSV plots, with each column representing numbers based on the intensity of the heat signature. By summing up the values in each line, the algorithm identifies the line with the highest sum, indicating the correct direction to hit the target. The corresponding angle (`ir_angle`) is then calculated and stored for turret alignment.

After the 6-second wait from multiple snapshots and receiving the last value for ir_angle, the system moves to state 3 in Mastermind, preserving `ir_angle` for subsequent states. In state 4, `ir_angle` is used to adjust the motor, recalculating `motor_setpoint` for precise alignment of the NERF gun with the target. State 5 activates the flywheel and servo motor to fire projectiles toward the target.

Upon task completion, the system transitions to state 6, resetting `motor_setpoint` to 0 to prevent unintended motor rotation and ensure readiness for the next command sequence.

In the main, we initialize the intertask variables ir_angle and motor_setpoint and tasks 1-3. The main file runs all tasks through the task scheduler from the file co_task(). 
</p>
<div class="image">
<img src="taskdiagram.JPG" alt="">
<div class="image">
<img src="state_diagram.JPG" alt="">
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
